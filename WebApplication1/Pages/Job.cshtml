@page
@using WebApplication1.Models
@model WebApplication1.Pages.JobsModel
@{
    ViewData["Title"] = "Робота";
}

<h2>Управління робочими</h2>

<form action="?handler=Add" method="post">
    @Html.AntiForgeryToken()
    <div class="mb-3">
        <input type="text" asp-for="CurrentJob.last_name"
               class="form-control" placeholder="Second name" required />
    </div>
    <div class="mb-3">
        <input type="text" asp-for="CurrentJob.first_name"
               class="form-control" placeholder="Name" required />
    </div>
    <div class="mb-3">
        <input type="text" asp-for="CurrentJob.middle_name"
               class="form-control" placeholder="Patronymic" step="0.01" required />
    </div>
    <div class="mb-3">
        @* <input type="" asp-for="CurrentJob.last_name"
               class="form-control" placeholder="Назва" required /> *@
        <section class="mb-3">
             <select asp-for="CurrentJob.gender" class="form-select" required>
                <option value="" disabled selected>Gender</option>
				<option value="Male">Male</option>
				<option value="Female">Female</option>
                <option value="Cocos">Cocos1</option>
			 </select>
		</section>
    </div>
    <div class="mb-3">
        <input type="date" asp-for="CurrentJob.birthday"
			   class="form-control" placeholder="Дата народження" required />
    </div>
    <div class="mb-3">
        <input type="number" asp-for="CurrentJob.height"
               class="form-control" placeholder="Height" required />
    </div>
    <div class="mb-3">
        <input type="number" asp-for="CurrentJob.children"
               class="form-control" placeholder="Children" required />
	</div>
    <div class="mb-3">
        <input type="text" asp-for="CurrentJob.department"
               class="form-control" placeholder="Department" required />
    </div>
    <div class="mb-3">
        <input type="text" asp-for="CurrentJob.position"
               class="form-control" placeholder="Position" required />
    </div>
    <div class="mb-3">
        <input type="text" asp-for="CurrentJob.brigade"
               class="form-control" placeholder="Brigade" required />
    </div>
    <div class="mb-3">
        <input type="date" asp-for="CurrentJob.birthday"
               class="form-control" placeholder="Дата народження" required />
    </div>
    <div class="mb-3">
        <input type="number" asp-for="CurrentJob.salary"
               class="form-control" placeholder="Salary" required />
    </div>
    <button type="submit" class="btn btn-success">
        Додати
    </button>
    <button class="">
        Filter
    </button>
</form>

<hr />

<h3>Список товарів</h3>
@* @foreach (Job job in Model.Jobs)
{
    <table>
        <tr class="list-group-item d-flex justify-content-between align-items-center">
            <td>
                <span>
                    <strong>@(job.Id).</strong> @(job.last_name) —
					@(job.first_name) — @(job.middle_name) —
					@(job.gender == "Male" ? "" : "") — @(job.birthday.ToShortDateString()) — @(job.height) cm — @(job.children) children — @(job.department) department — @(job.position) position — @(job.brigade) brigade — @(job.salary) грн.
                </span>
            </td>
            <td>
                <button class="btn btn-warning btn-sm edit-product"
                        data-id="@job.Id">
                    Змінити
                </button>
                <button class="btn btn-danger btn-sm delete-product"
                        data-id="@job.Id">
                    Видалити
                </button>
            </td>
		</tr>
    </table>
} *@

<table class="table table-dark table-striped-columns">
    <thead>
        <tr>
		    <th scope="col">Id</th>
            <th scope="col">First name, last name</th>
            <th scope="col">Gender</th>
            <th scope="col">Birthday</th>
            <th scope="col">Height</th>
            <th scope="col">Children</th>
            <th scope="col">Department</th>
            <th scope="col">Position</th>
            <th scope="col">Brigade</th>
            <th scope="col">Salary</th>
            <th scope="col">Actions</th>
	    </tr>
    </thead>
	<tbody>
        @foreach(Job job in Model.Jobs)
        {
            <tr>
			    <td>@job.Id</td>
			    <td>@job.last_name @job.first_name @job.middle_name</td>
                <td>@job.gender</td>
			    <td>@job.birthday.ToShortDateString()</td>
			    <td>@job.height cm</td>
			    <td>@job.children children</td>
			    <td>@job.department department</td>
			    <td>@job.position position</td>
			    <td>@job.brigade brigade</td>
			    <td>@job.salary грн.</td>
                <td> 
                    <button class="btn btn-warning btn-sm edit-product"
                            data-id="@job.Id">
                        Змінити
                    </button>
                    <button class="btn btn-danger btn-sm delete-product"
                            data-id="@job.Id">
                        Видалити
                    </button>
			    </td>
	        </tr>
        }
	</tbody>
</table>

@section Scripts {
    <script>
        const token = document.querySelector(
            'input[name="__RequestVerificationToken"]'
        ).value;
         document.querySelectorAll(".edit-product").forEach(button => {
            button.addEventListener("click", () => {
				const id = button.getAttribute("data-id");
                fetch(`?handler=Edit&id=${id}`, {
                    method: "POST",
                    headers: {
                        "RequestVerificationToken": token
                    }
                }).then(response => response.json())
                  .then(data => {
                        document.querySelector('input[name="CurrentJob.last_name"]').value = data.last_name;
                        document.querySelector('input[name="CurrentJob.first_name"]').value = data.first_name;
                        document.querySelector('input[name="CurrentJob.middle_name"]').value = data.middle_name;
					    document.querySelector('select[name="CurrentJob.genger"]').value = data.gender;
                        document.querySelector('input[name="CurrentJob.birthday"]').value = data.birthday;
                        document.querySelector('input[name="CurrentJob.height"]').value = data.height;
                        document.querySelector('input[name="CurrentJob.children"]').value = data.children;
                        document.querySelector('input[name="CurrentJob.department"]').value = data.department;
                        document.querySelector('input[name="CurrentJob.position"]').value = data.position;
                        document.querySelector('input[name="CurrentJob.brigade"]').value = data.brigade;
                        document.querySelector('input[name="CurrentJob.salary"]').value = data.salary;
                  });
            });
		});
        document.querySelectorAll(".delete-product").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-id");
                if (confirm("Ви впевнені, що хочете видалити цей запис?")) {
                    fetch(`?handler=Delete&id=${id}`, {
                        method: "POST",
                        headers: {
                            "RequestVerificationToken": token
                        }
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              location.reload();
                          } else {
                              alert("Помилка при видаленні запису!");
                          }
                      });
                }
            });
		});
	</script>
}
